{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</title>
    <link rel="icon" href="{% static 'img/barcode.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/upload.css' %}">
</head>
<body>
    <div class="general">
        <div class="foto-code-1"></div>
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
        <div class="container upload-container">
            <!-- –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ (–≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ) -->
            <form method="post" enctype="multipart/form-data" class="upload-form">
                {% csrf_token %}
                
                <!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ —é—Ä–ª–∏—Ü–∞ -->
                <div class="legal-entity-section">
                    <h2>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</h2>
                    <div class="entity-controls">
                        <select name="legal_entity" class="entity-select" id="legal_entity_select">
                            {% for entity in legal_entities %}
                                <option value="{{ entity }}" {% if entity == current_entity %}selected{% endif %}>
                                    {{ entity }}
                                </option>
                            {% endfor %}
                        </select>
                        
                        <div class="entity-actions">
                            <button type="submit" name="entity_action" value="update" class="btn-entity btn-use">
                                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                            </button>
                            <button type="submit" name="entity_action" value="save" class="btn-entity btn-save">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            <input type="text" name="new_entity" id="new_entity_input" 
                                   placeholder="–ù–æ–≤–æ–µ —é—Ä–ª–∏—Ü–æ" class="entity-input">
                            <button type="submit" name="entity_action" value="add" class="btn-entity btn-add">
                                + –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                            <button type="submit" name="entity_action" value="delete" class="btn-entity btn-delete" 
                                    onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —é—Ä–ª–∏—Ü–æ?')">
                                - –£–¥–∞–ª–∏—Ç—å
                            </button>
                            <input type="hidden" name="delete_entity" id="delete_entity_input" 
                                   value="{{ current_entity }}">
                        </div>
                    </div>
                </div>

                <h1>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h1>
                
                <!-- –û–ø—Ü–∏—è –º–∞—Å—Å–æ–≤–æ–π –ø–µ—á–∞—Ç–∏ -->
                <div class="upload-option">
                    <h3>üì¶ –ú–∞—Å—Å–æ–≤–∞—è –ø–µ—á–∞—Ç—å</h3>
                    <label class="upload-file-input">
                        {{ form.bulk_file }}
                        <span>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel (.xlsx)</span>
                    </label>
                    <p class="hint">–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –µ–¥–∏–Ω—ã–π PDF-—Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ —ç—Ç–∏–∫–µ—Ç–∫–∞–º–∏</p>
                </div>
                
                <!-- –û–ø—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤ -->
                <div class="upload-option">
                    <h3>üìÑ –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤</h3>
                    <label class="upload-file-input">
                        {{ form.template_file }}
                        <span>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel (.xlsx)</span>
                    </label>
                    <p class="hint">–°–æ–∑–¥–∞—Å—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ PDF-—Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞</p>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                <button type="submit" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 1. –ë–ª–æ–∫ —Ä–∞–±–æ—Ç—ã —Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ –ª–∏—Ü–∞–º–∏
        const entitySelect = document.getElementById('legal_entity_select');
        const newEntityInput = document.getElementById('new_entity_input');
        const deleteEntityInput = document.getElementById('delete_entity_input');
        const addBtn = document.querySelector('[name="entity_action"][value="add"]');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ select
        if (entitySelect && deleteEntityInput) {
            entitySelect.addEventListener('change', function() {
                deleteEntityInput.value = this.value;
                console.log('–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–æ:', this.value);
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ —é—Ä–ª–∏—Ü–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
        if (addBtn && newEntityInput) {
            addBtn.addEventListener('click', function(e) {
                if (!newEntityInput.value.trim()) {
                    e.preventDefault();
                    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —é—Ä–ª–∏—Ü–∞!');
                    newEntityInput.focus();
                }
            });
        }
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
        const saveBtn = document.querySelector('[name="entity_action"][value="save"]');
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                const entitySelect = document.querySelector('[name="legal_entity"]');
                if (entitySelect && entitySelect.value) {
                    setTimeout(() => {
                        alert("–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
                    }, 300); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
                }
            });
        }
        
        // 2. –ë–ª–æ–∫ –≤–∑–∞–∏–º–Ω–æ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
        const bulkInput = document.querySelector('[name="bulk_file"]');
        const templateInput = document.querySelector('[name="template_file"]');
        
        if (bulkInput && templateInput) {
            bulkInput.addEventListener('change', function() {
                if (this.files.length) templateInput.value = '';
            });
            templateInput.addEventListener('change', function() {
                if (this.files.length) bulkInput.value = '';
            });
        }
    });
    </script>
</body>
</html>